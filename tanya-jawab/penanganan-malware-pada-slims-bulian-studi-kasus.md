# 🛡️ Studi Kasus : Solusi Penanganan dan Pembersihan

Setelah mengidentifikasi jenis-jenis malware dan cara kerjanya pada Bagian 1, langkah selanjutnya adalah melakukan pembersihan total. Dokumen ini merinci prosedur langkah demi langkah untuk menemukan dan memberantas setiap ancaman dari server SLiMS Anda. Lakukan setiap langkah dengan hati-hati dan berurutan.

## ⚠️ Peringatan Sebelum Memulai
Tindakan di bawah ini melibatkan pencarian file, modifikasi konfigurasi, dan penghapusan. Pastikan Anda memiliki **backup** terbaru sebelum melanjutkan. Jika Anda tidak yakin, hubungi administrator sistem yang berpengalaman.

---

## Tahap 1: Isolasi dan Kontrol Kerusakan

Langkah pertama adalah menghentikan serangan yang sedang berlangsung dan mencegah penyerang mengakses server lebih jauh.

### Langkah 1: Blokir Alamat IP Penyerang 🚫
Gunakan firewall untuk segera memblokir semua alamat IP yang teridentifikasi dari analisis log. Ini adalah langkah krusial untuk memutus akses penyerang.

**Perintah (jalankan sebagai root/sudo):**
```bash
# Blokir IP yang teridentifikasi dalam serangan awal dan audit lanjutan
sudo iptables -A INPUT -s 182.3.47.242 -j DROP
sudo iptables -A INPUT -s 185.2.3.58 -j DROP
sudo iptables -A INPUT -s 157.245.53.39 -j DROP

# Simpan aturan firewall agar permanen (opsional, tergantung sistem)
sudo netfilter-persistent save
```

### Langkah 2: Matikan Proses Malware yang Berjalan 🛑
Hentikan proses penambang kripto yang berjalan tersembunyi.

**Cara Mencari & Menghentikan:**
```bash
# 1. Cari Proses ID (PID) dari proses yang menyamar sebagai '[raid5wq]'
ps aux | grep '[r]aid5wq'

# Output akan terlihat seperti ini:
# www-data  2168  ... [raid5wq]

# 2. Hentikan paksa proses tersebut menggunakan PID-nya
kill -9 2168
```

---

## Tahap 2: Pencarian dan Pembersihan File Berbahaya

Sekarang saatnya mencari, memvalidasi, lalu menghapus semua file dan konfigurasi yang ditanam oleh penyerang.

### Langkah 3: Hapus Malware Persisten (Cron Job) ⏰

**Cara Mencari 🔍:**
Periksa tugas terjadwal (*cron job*) milik pengguna `www-data` untuk menemukan perintah yang mencurigakan.
```bash
# Tampilkan semua cron job yang terdaftar untuk user www-data
sudo crontab -l -u www-data

# Perhatikan baris yang berisi string base64 yang panjang dan tidak wajar, seperti:
# 0 * * * * { echo L3Vz...udWxsAo=|base64 -d|bash;} 2>/dev/null #defunct-kernel
```

**Cara Menghapus 🗑️:**
Setelah perintah berbahaya divalidasi, hapus dari crontab dan hapus file binary-nya.
```bash
# 1. Buka editor crontab untuk pengguna www-data
sudo crontab -e -u www-data

# 2. Di dalam editor, HAPUS seluruh baris yang mencurigakan, lalu simpan & keluar.

# 3. Hapus direktori dan file binary malware yang dieksekusi oleh cron
sudo rm -rf /var/www/.config/htop/
```

### Langkah 4: Hapus Semua Backdoor dan Web Shell 🚪

**Cara Mencari 🔍:**
Gunakan kombinasi `find` dan `grep` untuk mencari file-file backdoor yang mungkin tersembunyi.
```bash
# Cari file dengan ekstensi mencurigakan seperti .alfa
sudo find /path/to/slims/ -name "*.alfa"

# Cari file .htaccess yang mengaktifkan CGI
sudo grep -r "ExecCGI" /path/to/slims/

# Cari file PHP yang mengandung fungsi-fungsi berbahaya.
# Ini sangat efektif untuk menemukan web shell yang namanya tidak diketahui.
sudo grep -r -l -E "eval\(|gzuncompress\(|base64_decode\(|openssl_decrypt\(|shell_exec\(" /path/to/slims/
```
Periksa setiap file yang ditemukan. Pastikan itu bukan bagian dari kode SLiMS yang sah sebelum menghapusnya.

**Cara Menghapus 🗑️:**
```bash
# Hapus Web Shell PHP Terenkripsi (nama file sesuaikan dengan temuan)
sudo rm /path/to/slims/lib/symfony/polyfill-mbstring/Resources/unidata/betawinesec.php

# Hapus direktori ALFA Backdoor Suite
sudo rm -rf /path/to/slims/repository/ALFA_DATA/

# Perbaiki file .htaccess yang telah dimodifikasi. Buka dan hapus baris berbahaya.
```

### Langkah 5: Bersihkan Skrip Cloaking dan Konten Spam 🎣

**Cara Mencari 🔍:**
Fokus pada file `index.php` di direktori utama SLiMS.
```bash
# 1. Periksa isi file index.php utama untuk kata kunci cloaking
grep -E "User-Agent|is_bot" /path/to/slims/index.php

# 2. Dari file index.php di atas, lihat file apa yang di-'include' untuk bot.
#    Itulah nama file halaman spam Anda (misal: home.php).

# 3. Periksa direktori mana saja yang file index.php-nya telah dihapus
find /path/to/slims/ -type d -exec test ! -f '{}/index.php' \; -print
```

**Cara Menghapus dan Memulihkan 🧹:**
```bash
# 1. Hapus file PHP yang berisi halaman spam
sudo rm /path/to/slims/home.php

# 2. Hapus file index.php yang sudah dimodifikasi
sudo rm /path/to/slims/index.php

# 3. Pulihkan file index.php yang asli (mungkin telah diubah nama menjadi 'old.php')
sudo mv /path/to/slims/old.php /path/to/slims/index.php

# 4. Pulihkan semua file index.php di subfolder yang hilang dari backup.
```

---

## Tahap 3: Verifikasi dan Validasi

### Langkah 6: Restart Layanan Server 🔄
Setelah pembersihan, restart layanan server untuk memastikan tidak ada sisa proses berbahaya yang berjalan di memori dan semua konfigurasi baru telah dimuat.

**Perintah:**
```bash
# Sangat disarankan untuk me-restart seluruh server
sudo reboot
```

### Ringkasan Tindakan
Pada titik ini, Anda telah berhasil:
- ✅ Memblokir akses penyerang.
- ✅ Menghentikan proses malware yang aktif.
- ✅ Menemukan dan menghapus mekanisme persistensi (*cron job*).
- ✅ Menemukan dan memberantas semua *backdoor* dan *web shell*.
- ✅ Membersihkan konten spam SEO dan memulihkan file inti.

Server Anda sekarang dalam kondisi bersih sementara. Langkah selanjutnya adalah memperkuat keamanan untuk mencegah serangan serupa terjadi lagi.
